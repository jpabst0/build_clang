cmake_minimum_required (VERSION 3.20)

project(clang_superbuild LANGUAGES)

include(ExternalProject)

set(INSTALL_PREFIX ${CMAKE_BINARY_DIR}/install)

set(COMMON_CMAKE_CACHE_ARGS
	-DCMAKE_BUILD_TYPE:STRING=Release
	-DCMAKE_INSTALL_PREFIX:PATH=${INSTALL_PREFIX}
	-DCMAKE_LIBRARY_PATH:PATH=${INSTALL_PREFIX}/lib
	-DCMAKE_SKIP_INSTALL_RPATH:BOOL=ON
)

ExternalProject_Add(
	CLANG
	GIT_REPOSITORY https://github.com/llvm/llvm-project.git
	GIT_TAG llvmorg-19.1.3
	SOURCE_SUBDIR llvm
	CMAKE_CACHE_ARGS
		${COMMON_CMAKE_CACHE_ARGS}
		-DLLVM_ENABLE_PROJECTS:STRING=clang lld
		-DLLVM_TARGETS_TO_BUILD:STRING=ARM
		-DLLVM_DEFAULT_TARGET_TRIPLE:STRING=arm-linux-gnueabihf
		-DLLVM_ENABLE_RUNTIMES:STRING=libunwind libcxxabi libcxx
		-DLLVM_RUNTIME_TARGETS:STRING=arm-linux-gnueabihf
		-DLLVM_INSTALL_TOOLCHAIN_ONLY:BOOL=ON
		-DCPACK_GENERATOR:STRING=TGZ
)
